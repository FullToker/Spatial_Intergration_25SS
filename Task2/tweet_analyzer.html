<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨æ–‡æ•°æ®ç»Ÿè®¡åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }
        
        .file-upload-zone {
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 40px 20px;
            margin: 20px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafbfc;
        }
        
        .file-upload-zone:hover {
            border-color: #667eea;
            background: #f0f2ff;
            transform: translateY(-2px);
        }
        
        .file-upload-zone.dragover {
            border-color: #667eea;
            background: #f0f2ff;
            transform: scale(1.02);
        }
        
        .file-upload-content {
            pointer-events: none;
        }
        
        .file-upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }
        
        .file-upload-text {
            font-size: 1.1em;
            color: #495057;
        }
        
        .file-upload-browse {
            color: #667eea;
            font-weight: 600;
            text-decoration: underline;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-weight: 500;
            color: #495057;
        }
        
        .stat-value {
            font-weight: 700;
            color: #667eea;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .error {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .summary h2 {
            margin-bottom: 15px;
            font-size: 1.8em;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .summary-number {
            font-size: 2em;
            font-weight: 700;
            display: block;
        }
        
        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š æ¨æ–‡æ•°æ®ç»Ÿè®¡åˆ†æ</h1>
        
        <div class="upload-section">
            <h3>ğŸ“¤ è¾“å…¥æ¨æ–‡JSONæ•°æ®</h3>
            <p style="margin: 10px 0; color: #666;">å¯ä»¥ä¸Šä¼ JSONæ–‡ä»¶æˆ–ç›´æ¥ç²˜è´´æ•°æ®ï¼ˆJSONæ ¼å¼ï¼Œå¯ä»¥æ˜¯å•æ¡æ¨æ–‡æˆ–æ¨æ–‡æ•°ç»„ï¼‰</p>
            
            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
            <div class="file-upload-zone" id="fileUploadZone">
                <div class="file-upload-content">
                    <div class="file-upload-icon">ğŸ“</div>
                    <div class="file-upload-text">
                        <strong>æ‹–æ‹½JSONæ–‡ä»¶åˆ°è¿™é‡Œ</strong> æˆ– <span class="file-upload-browse">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</span>
                    </div>
                    <input type="file" id="fileInput" accept=".json" style="display: none;">
                </div>
            </div>
            
            <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
            <div id="fileInfo" style="display: none; margin: 15px 0; padding: 10px; background: #e8f5e8; border-radius: 8px; color: #2d5f2d;">
                <span id="fileName"></span> - <span id="fileSize"></span>
            </div>
            
            <!-- ä¸Šä¼ è¿›åº¦æ˜¾ç¤º -->
            <div id="uploadProgress" style="display: none; margin: 15px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span id="progressText">æ­£åœ¨è¯»å–æ–‡ä»¶...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar" style="height: 12px;">
                    <div id="progressFill" class="progress-fill" style="width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 0.9em; color: #666;">
                    <span id="processedSize">0 MB</span> / <span id="totalSize">0 MB</span>
                    <span style="margin-left: 15px;">é¢„è®¡å‰©ä½™: <span id="remainingTime">è®¡ç®—ä¸­...</span></span>
                </div>
            </div>
            
            <div style="margin: 20px 0; color: #666; text-align: center;">
                <span>æˆ–è€…ç›´æ¥ç²˜è´´JSONæ•°æ®ï¼š</span>
            </div>
            
            <textarea id="jsonInput" placeholder='ä¾‹å¦‚ï¼š[{"_id": "...", "text": "...", ...}, {...}]'></textarea>
            <div>
                <button class="btn" onclick="analyzeData()">ğŸ” å¼€å§‹åˆ†æ</button>
                <button class="btn" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
                <button class="btn" onclick="loadSampleData()">ğŸ“‹ åŠ è½½ç¤ºä¾‹æ•°æ®</button>
            </div>
        </div>
        
        <div id="error" style="display: none;"></div>
        <div id="results" style="display: none;"></div>
    </div>

    <script>
        let tweetData = [];
        
        function loadSampleData() {
            const sampleData = `[
  {
    "_id": "573233b795f75e19d74ade49",
    "utc_offset": "7200",
    "country_code": "ES",
    "text": "Un toque de locura nunca viene mal, pues eso, HAKUNA MATATA ğŸ˜Š @â€¦ https://t.co/DGajofgNVK",
    "hashtags": "[]",
    "profile_image_url": "http://pbs.twimg.com/profile_images/561852859000836096/nGltxfpU_normal.jpeg",
    "bounding_box": {
      "type": "Polygon",
      "coordinates": "[[[-4.587928,36.635585],[-4.587928,36.894171],[-4.260134,36.894171],[-4.260134,36.635585]]]"
    },
    "coordinates": "[-4.46483776,36.72159228]",
    "full_name": "MÃ¡laga, EspaÃ±a",
    "geo": {
      "type": "Point",
      "coordinates": "[36.72159228,-4.46483776]"
    },
    "id": "616629946",
    "name": "MÃ¡laga",
    "lang": "es",
    "screen_name": "inmita96",
    "country": "EspaÃ±a",
    "created_at": "Tue May 10 19:17:11 +0000 2016",
    "time_zone": "Amsterdam",
    "place_type": "city",
    "timestamp_ms": "1462907831386",
    "source": "<a href=\\"http://instagram.com\\" rel=\\"nofollow\\">Instagram</a>",
    "followers_count": "736",
    "in_reply_to_screen_name": "null",
    "id_str": "730114479271325696",
    "urls": "[{\\"url\\":\\"https://t.co/DGajofgNVK\\",\\"indices\\":[65,88],\\"expanded_url\\":\\"https://www.instagram.com/p/BFPPfQ6QQ6E2B5s1rR9jwG9leitUdGElJ0MM880/\\",\\"display_url\\":\\"instagram.com/p/BFPPfQ6QQ6E2â€¦\\"}]",
    "location": "Villanueva de la ConcepciÃ³n"
  },
  {
    "_id": "573233b795f75e19d74ade4c",
    "utc_offset": "7200",
    "country_code": "FR",
    "text": "Motion de censure : Valls ne Â«craintÂ» pas le renversement de son gouvernement https://t.co/VaJm6hswH8 https://t.co/SZt5OP7oAK",
    "hashtags": "[]",
    "profile_image_url": "http://pbs.twimg.com/profile_images/726806794799054849/RiNXd3YM_normal.jpg",
    "bounding_box": {
      "type": "Polygon",
      "coordinates": "[[[2.272565,48.814219],[2.272565,48.828441],[2.301278,48.828441],[2.301278,48.814219]]]"
    },
    "coordinates": "[2.2892648,48.8249147]",
    "full_name": "Vanves, France",
    "geo": {
      "type": "Point",
      "coordinates": "[48.8249147,2.2892648]"
    },
    "id": "2735908681",
    "name": "Vanves",
    "lang": "fr",
    "screen_name": "VeilleDeCM",
    "country": "France",
    "created_at": "Tue May 10 19:17:11 +0000 2016",
    "time_zone": "Paris",
    "place_type": "city",
    "timestamp_ms": "1462907831320",
    "source": "<a href=\\"https://twitter.com/\\" rel=\\"nofollow\\">Client Twitter Web</a>",
    "followers_count": "5392",
    "in_reply_to_screen_name": "null",
    "id_str": "730114478994558976",
    "urls": "[{\\"url\\":\\"https://t.co/VaJm6hswH8\\",\\"indices\\":[78,101],\\"expanded_url\\":\\"http://l.leparisien.fr/Ae29-iLK8\\",\\"display_url\\":\\"l.leparisien.fr/Ae29-iLK8\\"}]",
    "location": "Vanves, France"
  }
]`;
            document.getElementById('jsonInput').value = sampleData;
        }
        
        function clearData() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = `<div class="error">âŒ ${message}</div>`;
            errorDiv.style.display = 'block';
        }
        
        function analyzeData() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                showError('è¯·è¾“å…¥JSONæ•°æ®');
                return;
            }
            
            // æ˜¾ç¤ºåˆ†æè¿›åº¦
            showAnalysisProgress();
            
            // ä½¿ç”¨ setTimeout è®©UIæœ‰æ—¶é—´æ›´æ–°
            setTimeout(() => {
                try {
                    showAnalysisStatus('æ­£åœ¨è§£æJSONæ•°æ®...');
                    let data = JSON.parse(input);
                    if (!Array.isArray(data)) {
                        data = [data];
                    }
                    
                    tweetData = data;
                    showAnalysisStatus(`è§£æå®Œæˆï¼å…± ${data.length} æ¡æ¨æ–‡ï¼Œå¼€å§‹åˆ†æ...`);
                    
                    // åˆ†æ‰¹å¤„ç†æ•°æ®
                    setTimeout(() => {
                        generateStatisticsAsync();
                    }, 100);
                    
                    document.getElementById('error').style.display = 'none';
                    
                } catch (e) {
                    hideAnalysisProgress();
                    showError('JSONæ ¼å¼é”™è¯¯: ' + e.message);
                }
            }, 100);
        }
        
        function showAnalysisProgress() {
            const progressHtml = `
                <div id="analysisProgress" style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 15px; text-align: center;">
                    <div style="font-size: 1.2em; font-weight: 600; color: #495057; margin-bottom: 15px;">
                        ğŸ”„ æ­£åœ¨åˆ†ææ•°æ®...
                    </div>
                    <div class="progress-bar" style="height: 12px; margin-bottom: 10px;">
                        <div id="analysisProgressFill" class="progress-fill" style="width: 0%; animation: pulse 2s infinite;"></div>
                    </div>
                    <div id="analysisStatus" style="color: #666; font-size: 0.9em;">
                        å‡†å¤‡å¼€å§‹...
                    </div>
                </div>
                <style>
                @keyframes pulse {
                    0% { opacity: 1; }
                    50% { opacity: 0.5; }
                    100% { opacity: 1; }
                }
                </style>
            `;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = progressHtml;
            resultsDiv.style.display = 'block';
        }
        
        function showAnalysisStatus(message) {
            const statusElement = document.getElementById('analysisStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }
        
        function updateAnalysisProgress(percent) {
            const progressFill = document.getElementById('analysisProgressFill');
            if (progressFill) {
                progressFill.style.width = percent + '%';
            }
        }
        
        function hideAnalysisProgress() {
            const analysisProgress = document.getElementById('analysisProgress');
            if (analysisProgress) {
                analysisProgress.remove();
            }
        }
        
        function generateStatisticsAsync() {
            const batchSize = 1000; // æ¯æ‰¹å¤„ç†1000æ¡æ¨æ–‡
            const totalTweets = tweetData.length;
            let processedCount = 0;
            
            const stats = {
                total: totalTweets,
                languages: {},
                countries: {},
                timezones: {},
                sources: {},
                placeTypes: {},
                textLengths: [],
                followerCounts: [],
                coordinates: [],
                hasGeo: 0,
                hasHashtags: 0,
                hasUrls: 0,
                uniqueUsers: new Set(),
                timeDistribution: {}
            };
            
            function processBatch() {
                const endIndex = Math.min(processedCount + batchSize, totalTweets);
                const batch = tweetData.slice(processedCount, endIndex);
                
                // å¤„ç†å½“å‰æ‰¹æ¬¡
                batch.forEach(tweet => {
                    // è¯­è¨€ç»Ÿè®¡
                    if (tweet.lang) {
                        stats.languages[tweet.lang] = (stats.languages[tweet.lang] || 0) + 1;
                    }
                    
                    // å›½å®¶ç»Ÿè®¡
                    if (tweet.country) {
                        stats.countries[tweet.country] = (stats.countries[tweet.country] || 0) + 1;
                    }
                    
                    // æ—¶åŒºç»Ÿè®¡
                    if (tweet.time_zone) {
                        stats.timezones[tweet.time_zone] = (stats.timezones[tweet.time_zone] || 0) + 1;
                    }
                    
                    // æ¥æºç»Ÿè®¡
                    if (tweet.source) {
                        let source = tweet.source.replace(/<[^>]*>/g, '');
                        stats.sources[source] = (stats.sources[source] || 0) + 1;
                    }
                    
                    // åœ°ç‚¹ç±»å‹ç»Ÿè®¡
                    if (tweet.place_type) {
                        stats.placeTypes[tweet.place_type] = (stats.placeTypes[tweet.place_type] || 0) + 1;
                    }
                    
                    // æ–‡æœ¬é•¿åº¦
                    if (tweet.text) {
                        stats.textLengths.push(tweet.text.length);
                    }
                    
                    // ç²‰ä¸æ•°é‡
                    if (tweet.followers_count) {
                        const count = parseInt(tweet.followers_count);
                        if (!isNaN(count)) {
                            stats.followerCounts.push(count);
                        }
                    }
                    
                    // åœ°ç†ä½ç½®
                    if (tweet.coordinates || tweet.geo) {
                        stats.hasGeo++;
                        if (tweet.coordinates) {
                            try {
                                const coords = JSON.parse(tweet.coordinates);
                                stats.coordinates.push(coords);
                            } catch (e) {}
                        }
                    }
                    
                    // æ ‡ç­¾å’Œé“¾æ¥
                    if (tweet.hashtags && tweet.hashtags !== '[]') {
                        stats.hasHashtags++;
                    }
                    
                    if (tweet.urls && tweet.urls !== '[]') {
                        stats.hasUrls++;
                    }
                    
                    // ç”¨æˆ·ç»Ÿè®¡
                    if (tweet.screen_name) {
                        stats.uniqueUsers.add(tweet.screen_name);
                    }
                    
                    // æ—¶é—´åˆ†å¸ƒ
                    if (tweet.created_at) {
                        const date = new Date(tweet.created_at);
                        const hour = date.getHours();
                        stats.timeDistribution[hour] = (stats.timeDistribution[hour] || 0) + 1;
                    }
                });
                
                processedCount = endIndex;
                const progress = Math.round((processedCount / totalTweets) * 100);
                
                // æ›´æ–°è¿›åº¦
                updateAnalysisProgress(progress);
                showAnalysisStatus(`å·²å¤„ç† ${processedCount.toLocaleString()} / ${totalTweets.toLocaleString()} æ¡æ¨æ–‡ (${progress}%)`);
                
                if (processedCount < totalTweets) {
                    // ç»§ç»­å¤„ç†ä¸‹ä¸€æ‰¹ï¼Œç»™UIæ—¶é—´æ›´æ–°
                    setTimeout(processBatch, 10);
                } else {
                    // å¤„ç†å®Œæˆï¼Œæ˜¾ç¤ºç»“æœ
                    showAnalysisStatus('åˆ†æå®Œæˆï¼æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...');
                    setTimeout(() => {
                        hideAnalysisProgress();
                        displayResults(stats);
                    }, 500);
                }
            }
            
            // å¼€å§‹å¤„ç†
            processBatch();
        }
        
        function displayResults(stats) {
            const resultsDiv = document.getElementById('results');
            
            // è®¡ç®—ç»Ÿè®¡å€¼
            const avgTextLength = stats.textLengths.length > 0 ? 
                Math.round(stats.textLengths.reduce((a, b) => a + b, 0) / stats.textLengths.length) : 0;
            
            const avgFollowers = stats.followerCounts.length > 0 ? 
                Math.round(stats.followerCounts.reduce((a, b) => a + b, 0) / stats.followerCounts.length) : 0;
            
            let html = `
                <div class="summary">
                    <h2>ğŸ“‹ æ•°æ®æ¦‚è§ˆ</h2>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-number">${stats.total}</span>
                            <span class="summary-label">æ€»æ¨æ–‡æ•°</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${stats.uniqueUsers.size}</span>
                            <span class="summary-label">ç‹¬ç«‹ç”¨æˆ·</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${Object.keys(stats.languages).length}</span>
                            <span class="summary-label">è¯­è¨€ç±»å‹</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${Object.keys(stats.countries).length}</span>
                            <span class="summary-label">å›½å®¶æ•°é‡</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${avgTextLength}</span>
                            <span class="summary-label">å¹³å‡å­—ç¬¦æ•°</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${Math.round((stats.hasGeo / stats.total) * 100)}%</span>
                            <span class="summary-label">æœ‰åœ°ç†ä½ç½®</span>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid">
            `;
            
            // è¯­è¨€åˆ†å¸ƒ
            html += createStatCard('ğŸŒ è¯­è¨€åˆ†å¸ƒ', stats.languages, stats.total);
            
            // å›½å®¶åˆ†å¸ƒ
            html += createStatCard('ğŸŒ å›½å®¶åˆ†å¸ƒ', stats.countries, stats.total);
            
            // æ—¶åŒºåˆ†å¸ƒ
            html += createStatCard('ğŸ• æ—¶åŒºåˆ†å¸ƒ', stats.timezones, stats.total);
            
            // æ¥æºåˆ†å¸ƒ
            html += createStatCard('ğŸ“± å‘å¸ƒæ¥æº', stats.sources, stats.total);
            
            // åœ°ç‚¹ç±»å‹
            if (Object.keys(stats.placeTypes).length > 0) {
                html += createStatCard('ğŸ“ åœ°ç‚¹ç±»å‹', stats.placeTypes, stats.total);
            }
            
            // æ–‡æœ¬ç»Ÿè®¡
            if (stats.textLengths.length > 0) {
                const textStats = {
                    'å¹³å‡é•¿åº¦': avgTextLength,
                    'æœ€çŸ­': Math.min(...stats.textLengths),
                    'æœ€é•¿': Math.max(...stats.textLengths),
                    'æ€»å­—ç¬¦æ•°': stats.textLengths.reduce((a, b) => a + b, 0)
                };
                html += createStatCard('ğŸ“ æ–‡æœ¬ç»Ÿè®¡', textStats);
            }
            
            // ç²‰ä¸ç»Ÿè®¡
            if (stats.followerCounts.length > 0) {
                const followerStats = {
                    'å¹³å‡ç²‰ä¸æ•°': avgFollowers,
                    'æœ€å°‘ç²‰ä¸': Math.min(...stats.followerCounts),
                    'æœ€å¤šç²‰ä¸': Math.max(...stats.followerCounts),
                    'ä¸­ä½æ•°': getMedian(stats.followerCounts)
                };
                html += createStatCard('ğŸ‘¥ ç²‰ä¸ç»Ÿè®¡', followerStats);
            }
            
            // å†…å®¹ç‰¹å¾
            const contentStats = {
                'åŒ…å«åœ°ç†ä½ç½®': `${stats.hasGeo} (${Math.round((stats.hasGeo / stats.total) * 100)}%)`,
                'åŒ…å«æ ‡ç­¾': `${stats.hasHashtags} (${Math.round((stats.hasHashtags / stats.total) * 100)}%)`,
                'åŒ…å«é“¾æ¥': `${stats.hasUrls} (${Math.round((stats.hasUrls / stats.total) * 100)}%)`
            };
            html += createStatCard('ğŸ·ï¸ å†…å®¹ç‰¹å¾', contentStats);
            
            // æ—¶é—´åˆ†å¸ƒ
            if (Object.keys(stats.timeDistribution).length > 0) {
                html += createStatCard('â° å‘å¸ƒæ—¶é—´åˆ†å¸ƒï¼ˆ24å°æ—¶åˆ¶ï¼‰', stats.timeDistribution, stats.total);
            }
            
            html += '</div>';
            
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }
        
        function createStatCard(title, data, total = null) {
            let html = `
                <div class="stat-card">
                    <div class="stat-title">${title}</div>
            `;
            
            if (typeof data === 'object') {
                const sortedEntries = Object.entries(data)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10); // æ˜¾ç¤ºå‰10é¡¹
                
                sortedEntries.forEach(([key, value]) => {
                    const percentage = total ? Math.round((value / total) * 100) : null;
                    html += `
                        <div class="stat-item">
                            <span class="stat-label">${key}</span>
                            <span class="stat-value">${value}${percentage ? ` (${percentage}%)` : ''}</span>
                        </div>
                    `;
                    
                    if (total && percentage) {
                        html += `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%"></div>
                            </div>
                        `;
                    }
                });
                
                if (Object.keys(data).length > 10) {
                    html += `<div class="stat-item"><span class="stat-label">... è¿˜æœ‰ ${Object.keys(data).length - 10} é¡¹</span></div>`;
                }
            }
            
            html += '</div>';
            return html;
        }
        
        function getMedian(arr) {
            const sorted = [...arr].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 !== 0 ? sorted[mid] : Math.round((sorted[mid - 1] + sorted[mid]) / 2);
        }
        
        // æ–‡ä»¶ä¸Šä¼ ç›¸å…³åŠŸèƒ½
        function setupFileUpload() {
            const fileUploadZone = document.getElementById('fileUploadZone');
            const fileInput = document.getElementById('fileInput');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            const progressFill = document.getElementById('progressFill');
            const processedSize = document.getElementById('processedSize');
            const totalSize = document.getElementById('totalSize');
            const remainingTime = document.getElementById('remainingTime');
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
            fileUploadZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©
            fileInput.addEventListener('change', (e) => {
                handleFileSelect(e.target.files[0]);
            });
            
            // æ‹–æ‹½åŠŸèƒ½
            fileUploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadZone.classList.add('dragover');
            });
            
            fileUploadZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                fileUploadZone.classList.remove('dragover');
            });
            
            fileUploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadZone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });
            
            function handleFileSelect(file) {
                if (!file) return;
                
                if (!file.name.toLowerCase().endsWith('.json')) {
                    showError('è¯·é€‰æ‹©JSONæ ¼å¼çš„æ–‡ä»¶');
                    return;
                }
                
                // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                fileInfo.style.display = 'block';
                
                // å¤§æ–‡ä»¶è­¦å‘Š
                if (file.size > 50 * 1024 * 1024) { // 50MB
                    showWarning(`æ–‡ä»¶è¾ƒå¤§ (${formatFileSize(file.size)})ï¼Œè¯»å–å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…...`);
                }
                
                // æ˜¾ç¤ºè¿›åº¦æ¡
                uploadProgress.style.display = 'block';
                progressText.textContent = 'æ­£åœ¨è¯»å–æ–‡ä»¶...';
                progressPercent.textContent = '0%';
                progressFill.style.width = '0%';
                totalSize.textContent = formatFileSize(file.size);
                processedSize.textContent = '0 MB';
                remainingTime.textContent = 'è®¡ç®—ä¸­...';
                
                // ä½¿ç”¨åˆ†å—è¯»å–å¤§æ–‡ä»¶
                readFileWithProgress(file);
            }
            
            function readFileWithProgress(file) {
                const chunkSize = 1024 * 1024; // 1MB chunks
                const totalChunks = Math.ceil(file.size / chunkSize);
                let currentChunk = 0;
                let result = '';
                const startTime = Date.now();
                
                function readNextChunk() {
                    const start = currentChunk * chunkSize;
                    const end = Math.min(start + chunkSize, file.size);
                    const chunk = file.slice(start, end);
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        result += e.target.result;
                        currentChunk++;
                        
                        // æ›´æ–°è¿›åº¦
                        const progress = (currentChunk / totalChunks) * 100;
                        const processedBytes = Math.min(currentChunk * chunkSize, file.size);
                        
                        progressFill.style.width = progress + '%';
                        progressPercent.textContent = Math.round(progress) + '%';
                        processedSize.textContent = formatFileSize(processedBytes);
                        
                        // è®¡ç®—å‰©ä½™æ—¶é—´
                        if (currentChunk > 1) {
                            const elapsed = Date.now() - startTime;
                            const rate = processedBytes / elapsed; // bytes per ms
                            const remaining = (file.size - processedBytes) / rate;
                            remainingTime.textContent = formatTime(remaining);
                        }
                        
                        if (currentChunk < totalChunks) {
                            // ä½¿ç”¨ setTimeout é¿å…é˜»å¡ UI
                            setTimeout(readNextChunk, 10);
                        } else {
                            // è¯»å–å®Œæˆ
                            progressText.textContent = 'æ–‡ä»¶è¯»å–å®Œæˆï¼';
                            document.getElementById('jsonInput').value = result;
                            
                            setTimeout(() => {
                                uploadProgress.style.display = 'none';
                                showSuccess(`æ–‡ä»¶ "${file.name}" å·²æˆåŠŸåŠ è½½ï¼(${formatFileSize(file.size)})`);
                            }, 500);
                        }
                    };
                    
                    reader.onerror = () => {
                        showError('æ–‡ä»¶è¯»å–å¤±è´¥');
                        uploadProgress.style.display = 'none';
                    };
                    
                    reader.readAsText(chunk);
                }
                
                readNextChunk();
            }
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            function formatTime(ms) {
                if (ms < 1000) return '< 1ç§’';
                const seconds = Math.floor(ms / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                
                if (hours > 0) return `${hours}å°æ—¶${minutes % 60}åˆ†é’Ÿ`;
                if (minutes > 0) return `${minutes}åˆ†é’Ÿ${seconds % 60}ç§’`;
                return `${seconds}ç§’`;
            }
        }
        
        function showSuccess(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = `<div style="background: #f0f9ff; border: 1px solid #0ea5e9; color: #0c4a6e; padding: 15px; border-radius: 10px; margin: 10px 0;">âœ… ${message}</div>`;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }
        
        function showWarning(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = `<div style="background: #fffbeb; border: 1px solid #f59e0b; color: #92400e; padding: 15px; border-radius: 10px; margin: 10px 0;">âš ï¸ ${message}</div>`;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        function clearData() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('fileInput').value = '';
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadSampleData();
            setupFileUpload();
        };
    </script>
</body>
</html>